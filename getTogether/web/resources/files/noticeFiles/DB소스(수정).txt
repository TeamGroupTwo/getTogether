-- 프로젝트 계정 생성
-- CREATE USER gtogether IDENTIFIED BY gtogether;
-- GRANT CONNECT, RESOURCE, CREATE VIEW, CREATE SEQUENCE TO gtogether;

-- 직급 테이블
CREATE TABLE RANK(
  R_CODE CHAR(2),
  R_NAME CHAR(6) NOT NULL,
  CONSTRAINTS PK_R PRIMARY KEY(R_CODE)
);

INSERT INTO RANK VALUES('R1', '사원');
INSERT INTO RANK VALUES('R2', '주임');
INSERT INTO RANK VALUES('R3', '대리');
INSERT INTO RANK VALUES('R4', '과장');
INSERT INTO RANK VALUES('R5', '차장');
INSERT INTO RANK VALUES('R6', '부장');
INSERT INTO RANK VALUES('RS', '관리');
commit;

-- 부서 테이블
CREATE TABLE DEPARTMENT(
  D_CODE CHAR(2),
  D_NAME VARCHAR(20) NOT NULL,
  CONSTRAINTS PK_D PRIMARY KEY(D_CODE)
);

INSERT INTO DEPARTMENT VALUES('D1', '회계부');
INSERT INTO DEPARTMENT VALUES('D2', '인사부');
INSERT INTO DEPARTMENT VALUES('D3', '전략기획부');
INSERT INTO DEPARTMENT VALUES('D4', '영업부');
INSERT INTO DEPARTMENT VALUES('D5', '개발부');
INSERT INTO DEPARTMENT VALUES('D6', '법무부');
INSERT INTO DEPARTMENT VALUES('DS', '시스템관리');

-- 직원 테이블
CREATE TABLE EMPLOYEE(
  E_NO NUMBER,
  E_ID CHAR(6) NOT NULL,
  E_PASSWORD VARCHAR(64) NOT NULL,
  E_NAME VARCHAR(15) NOT NULL,
  PHONE VARCHAR(11),
  EMAIL VARCHAR(50),
  PROFILE VARCHAR(300),
  R_CODE CHAR(2) NOT NULL,
  D_CODE CHAR(2) NOT NULL,
  CONSTRAINTS PK_E PRIMARY KEY(E_NO),
  CONSTRAINTS UK_E_ID UNIQUE(E_ID),
  CONSTRAINTS UK_E_EMAIL UNIQUE(EMAIL),
  CONSTRAINTS FK_R_E FOREIGN KEY(R_CODE) REFERENCES RANK(R_CODE),
  CONSTRAINTS FK_D_E FOREIGN KEY(D_CODE) REFERENCES DEPARTMENT(D_CODE)
);

INSERT INTO EMPLOYEE(E_NO, E_ID, E_PASSWORD, E_NAME, R_CODE, D_CODE) VALUES('20180001', 'test01', '1234', '테스트', 'R1', 
'D1');
INSERT INTO EMPLOYEE VALUES('20180002', 'test02', '1234', '시험용','01011112222', 'test@test.com', null,'R2', 'D4');
INSERT INTO EMPLOYEE VALUES('99999901', 'admin1', 'admin', '관리자1','01089898989', 'admin@test.com', null,'RS', 'DS');

--INSERT INTO EMPLOYEE VALUES('20180003', 'jiae12', '1234', '유지애','01091954216', 'jiae@test.com', null,'R2', 'D1');
commit;

-- 일정 테이블
CREATE TABLE SCHEDULE(
  S_NO NUMBER,
  S_TITLE VARCHAR(50) NOT NULL,
  S_CONTENT VARCHAR(1500),
  S_COLOR CHAR(7) NOT NULL,
  S_DATE DATE DEFAULT SYSDATE NOT NULL,
  S_TIME VARCHAR(30),
  E_NO NUMBER NOT NULL,
  CONSTRAINTS PK_S PRIMARY KEY(S_NO),
  CONSTRAINTS FK_E_S FOREIGN KEY(E_NO) REFERENCES EMPLOYEE(E_NO)
);

-- 파일 테이블
CREATE TABLE FILES(
  F_NO NUMBER,
  F_PATH VARCHAR(1000) NOT NULL,
  F_NAME VARCHAR(300) NOT NULL,
  F_TYPE CHAR(2) NOT NULL,
  CONSTRAINTS PK_F PRIMARY KEY(F_NO),
  CONSTRAINTS CK_F_TYPE CHECK(F_TYPE IN ('FD','FL'))
);

-- 공지사항 테이블
CREATE TABLE NOTICE(
  N_NO NUMBER,
  N_TITLE VARCHAR(50) NOT NULL,
  N_CONTENT VARCHAR(3000) NOT NULL,
  N_WRITER VARCHAR(15) NOT NULL,
  N_COUNT NUMBER DEFAULT 0 NOT NULL,
  N_DATE DATE DEFAULT SYSDATE NOT NULL,
  N_FIX CHAR(1) DEFAULT 'N' NOT NULL,
  E_NO NUMBER NOT NULL,
  F_NO NUMBER,
  CONSTRAINTS PK_N PRIMARY KEY(N_NO),
  CONSTRAINTS CK_N_FIX CHECK(N_FIX IN ('Y','N')),
  CONSTRAINTS FK_E_N FOREIGN KEY(E_NO) REFERENCES EMPLOYEE(E_NO),
  CONSTRAINTS FK_F_N FOREIGN KEY(F_NO) REFERENCES FILES(F_NO)
);

-- 프로젝트 테이블
CREATE TABLE PROJECT(
  P_NO NUMBER,
  P_TITLE VARCHAR(60) NOT NULL,
  P_DATE DATE DEFAULT SYSDATE NOT NULL,
  D_CODE CHAR(2) NOT NULL,
  CONSTRAINTS PK_P PRIMARY KEY(P_NO),
  CONSTRAINTS FK_D_P FOREIGN KEY(D_CODE) REFERENCES DEPARTMENT(D_CODE)
);

-- 부서게시판 업무 테이블
CREATE TABLE WORK(
  W_NO NUMBER,
  W_TITLE VARCHAR(50) NOT NULL,
  W_CONTENT VARCHAR(3000) NOT NULL,
  W_WRITER VARCHAR(15) NOT NULL,
  P_NO NUMBER,
  W_DATE DATE DEFAULT SYSDATE NOT NULL,
  E_NO NUMBER NOT NULL,
  F_NO NUMBER,
  CONSTRAINTS PK_W PRIMARY KEY(W_NO),
  CONSTRAINTS FK_P_W FOREIGN KEY(P_NO) REFERENCES PROJECT(P_NO) ON DELETE CASCADE,
  CONSTRAINTS FK_E_W FOREIGN KEY(E_NO) REFERENCES EMPLOYEE(E_NO),
  CONSTRAINTS FK_F_W FOREIGN KEY(F_NO) REFERENCES FILES(F_NO) ON DELETE CASCADE
);

-- 부서게시판 업무 댓글 테이블
CREATE TABLE WORKCOMMENT(
  WC_NO NUMBER,
  WC_WRITER VARCHAR(15) NOT NULL,
  WC_CONTENT VARCHAR(1500) NOT NULL,
  WC_DATE DATE DEFAULT SYSDATE NOT NULL,
  W_NO NUMBER NOT NULL,
  E_NO NUMBER NOT NULL,
  CONSTRAINTS PK_WC PRIMARY KEY(WC_NO),
  CONSTRAINTS FK_W_WC FOREIGN KEY(W_NO) REFERENCES WORK(W_NO) ON DELETE CASCADE,
  CONSTRAINTS FK_E_WC FOREIGN KEY(E_NO) REFERENCES EMPLOYEE(E_NO)
);


-- 일정 시퀀스
CREATE SEQUENCE SEQ_S_SNO;

-- 프로젝트 시퀀스
CREATE SEQUENCE SEQ_P_PNO;

-- 업무댓글 시퀀스
CREATE SEQUENCE SEQ_WC_WCNO;

-- 파일 시퀀스
CREATE SEQUENCE SEQ_F_FNO;

-- 부서게시판 시퀀스
CREATE SEQUENCE SEQ_W_WNO;

-- 공지사항 시퀀스
CREATE SEQUENCE SEQ_N_NNO;

COMMIT;

--DROP TABLE WORKCOMMENT;
--DROP TABLE FILES;
--DROP TABLE WORK;
--DROP TABLE PROJECT;
--DROP TABLE SCHEDULE;
--DROP TABLE NOTICE;
--DROP TABLE EMPLOYEE;
--DROP TABLE RANK;
--DROP TABLE DEPARTMENT;
